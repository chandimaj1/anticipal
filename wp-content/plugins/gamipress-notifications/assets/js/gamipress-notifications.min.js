(function($,document){$.gamipress_notify.addStyle('gamipress',{html:'<div>'+'<div class="gamipress-notification-close"></div>'+'<div class="gamipress-notification-content" data-notify-html="content"></div>'+'</div>'});$(document).on('click','.gamipress-notification .gamipress-notification-close',function(){$(this).trigger('notify-hide')});function gamipress_notifications_is_document_visible(){var state,event,keys={hidden:"visibilitychange",webkitHidden:"webkitvisibilitychange",mozHidden:"mozvisibilitychange",msHidden:"msvisibilitychange"};for(state in keys){if(state in document){event=keys[state];break}}
return!document[state]}
var notifications_displayed=[];function gamipress_notifications_notify(content){var id=$(content).attr('id');var extra_classes=$(content).attr('class');if(notifications_displayed.includes(id)){return}
notifications_displayed.push(id);if($('#'+id+'.gamipress-notification').length){return}
var position=gamipress_notifications.position;if(position==='middle left'){position='left middle'}else if(position==='middle right'){position='right middle'}
$.gamipress_notify({content:content,},{style:'gamipress',id:id,className:'notification gamipress-notification '+extra_classes,position:position,clickToHide:gamipress_notifications.click_to_hide,autoHide:(gamipress_notifications.auto_hide&&parseInt(gamipress_notifications.auto_hide_delay)>0),autoHideDelay:gamipress_notifications.auto_hide_delay,showAnimation:'slideDown',showDuration:400,hideAnimation:'slideUp',hideDuration:200,onOpen:function(notification){var show_sound=notification.find('#gamipress-notification-show-sound');if(show_sound.length){gamipress_notifications_play_sound(show_sound.data('src'))}},onClose:function(notification){var hide_sound=notification.find('#gamipress-notification-hide-sound');if(hide_sound.length){gamipress_notifications_play_sound(hide_sound.data('src'))}}})}
function gamipress_notifications_play_sound(src){var filename=src.split(/[\\\/]/).pop();if(filename===undefined)return;var src_parts=src.match(/\.([^.]+)$/);if(src_parts===null)return;var ext=src_parts[1];var id=filename.replace('.','_');var source=document.createElement('source');source.src=src;source.type='audio/'+ext;var audio=document.createElement('audio');audio.id=id;audio.appendChild(source);document.body.appendChild(audio);audio.currentTime=0;audio.volume=1;audio.load();setTimeout(function(){audio.play().catch(()=>{audio.play().catch(()=>{})})},0)}
var notifications_request;var times_without_notifications=0;function gamipress_notifications_check_notices(){if(gamipress_notifications.disable_live_checks){return}
var delay=parseInt(gamipress_notifications.delay);if(!gamipress_notifications_is_document_visible()){setTimeout(gamipress_notifications_check_notices,delay);return}
var attempts_to_cancel=parseInt(gamipress_notifications.attempts_to_cancel);if(attempts_to_cancel!==0){if(times_without_notifications>attempts_to_cancel){return}}
if(notifications_request!==undefined){return}
var show_user_points=$('.gamipress-user-points').length;notifications_request=$.ajax({url:gamipress_notifications.ajaxurl,data:{action:'gamipress_notifications_get_notices',nonce:gamipress_notifications.nonce,user_points:show_user_points},success:function(response){var i;if(response.data.notices!==undefined&&response.data.notices.length){for(i=0;i<response.data.notices.length;i++){var content=response.data.notices[i];gamipress_notifications_notify(content)}
times_without_notifications=0}else{times_without_notifications++}
setTimeout(gamipress_notifications_check_notices,delay);if(show_user_points&&response.data.user_points.length){for(i=0;i<response.data.user_points.length;i++){var user_points=response.data.user_points[i];$('.gamipress-user-points.gamipress-is-current-user .gamipress-user-points-'+user_points.points_type+' .gamipress-user-points-count').text(user_points.points)}}
notifications_request=undefined}})}
var notifications_last_check_request;function gamipress_notifications_update_last_check(){if(notifications_last_check_request!==undefined){return}
notifications_last_check_request=$.ajax({url:gamipress_notifications.ajaxurl,data:{action:'gamipress_notifications_last_check',nonce:gamipress_notifications.nonce,last_check:$('#gamipress-notifications-user-last-check').data('value'),},success:function(response){notifications_last_check_request=undefined}})}
$('.gamipress-notifications-user-notices > div').each(function(){if($(this).attr('id')==='gamipress-notification-show-sound')
return!0;if($(this).attr('id')==='gamipress-notification-hide-sound')
return!0;var content=$(this)[0].outerHTML;var show_selector='#gamipress-notification-show-sound';var hide_selector='#gamipress-notification-hide-sound';if($(this).next(show_selector).length)
content+=$(this).next(show_selector)[0].outerHTML;if($(this).next(hide_selector).length)
content+=$(this).next(hide_selector)[0].outerHTML;if($(this).next(show_selector).next(hide_selector).length)
content+=$(this).next(show_selector).next(hide_selector)[0].outerHTML;gamipress_notifications_notify(content);setTimeout(gamipress_notifications_update_last_check,gamipress_notifications.last_check_delay)});if(!gamipress_notifications.disable_live_checks){gamipress_notifications_check_notices()}})(jQuery,document)